<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Tom Cranstoun" />
  <meta name="description" content="Practical guidance from The Invisible Users book on designing AI agent-friendly websites" />
  <title>Appendix B: Battle-Tested Lessons</title>
  

  <link rel="canonical" href="https://allabout.network/invisible-users/appendix-b.html">
  <!-- AI-specific meta tags (proposed pattern from Chapter 10) -->
  <meta name="ai-preferred-access" content="html">
  <meta name="ai-content-policy" content="summaries-allowed, full-extraction-allowed">
  <meta name="ai-freshness" content="monthly">
  <meta name="ai-structured-data" content="json-ld">
  <meta name="ai-attribution" content="required" text="Source: The Invisible Users by Tom Cranstoun, https://allabout.network/invisible-users/">
  <meta name="llms-txt" content="/llms.txt">
  <!-- Schema.org structured data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "name": "Appendix B: Battle-Tested Lessons",
    "description": "Practical guidance from The Invisible Users book on designing AI agent-friendly websites",
    "author": {
      "@type": "Person",
      "name": "Tom Cranstoun",
      "email": "tom.cranstoun@gmail.com",
      "url": "https://allabout.network"
    },
    "inLanguage": "en-GB",
    "datePublished": "2026-01-10",
    "dateModified": "2026-01-10",
    "isPartOf": {
      "@type": "Book",
      "name": "The Invisible Users",
      "author": {
        "@type": "Person",
        "name": "Tom Cranstoun"
      },
      "url": "https://allabout.network/invisible-users"
    },
    "position": "2"
  }
  </script>
  <link rel="stylesheet" href="appendix.css">
</head>
<body>
<nav class="appendix-navigation" role="navigation" aria-label="Appendix Navigation">
    <p><a href="appendix-index.html">← Back to Appendices Index</a></p>
    <p>Quick navigation:
        <a href="appendix-a.html">A</a> |
        <a href="appendix-b.html">B</a> |
        <a href="appendix-c.html">C</a> |
        <a href="appendix-d.html">D</a> |
        <a href="appendix-e.html">E</a> |
        <a href="appendix-f.html">F</a> |
        <a href="appendix-g.html">G</a> |
        <a href="appendix-h.html">H</a> |
        <a href="appendix-i.html">I</a> |
        <a href="appendix-j.html">J</a> |
        <a href="appendix-k.html">K</a> |
        <a href="appendix-l.html">L</a>
    </p>
</nav>
<hr>
<header id="title-block-header">
<h1 class="title">Appendix B: Battle-Tested Lessons</h1>
<p class="subtitle">The Invisible Users</p>
<p class="author">Tom Cranstoun</p>
<p class="date">January 2026</p>
</header>
<nav id="TOC" role="navigation" aria-label="Table of Contents">
<ul>
<li><a href="#appendix-b-battle-tested-lessons"
id="toc-appendix-b-battle-tested-lessons">Appendix B: Battle-Tested
Lessons</a>
<ul>
<li><a href="#progressive-enhancement-requires-discipline"
id="toc-progressive-enhancement-requires-discipline">1. Progressive
Enhancement Requires Discipline</a></li>
<li><a href="#toast-notifications-are-hard-to-kill"
id="toc-toast-notifications-are-hard-to-kill">2. Toast Notifications are
Hard to Kill</a></li>
<li><a href="#pagination-removal-needs-backend-changes"
id="toc-pagination-removal-needs-backend-changes">3. Pagination Removal
Needs Backend Changes</a></li>
<li><a href="#structured-data-gets-out-of-sync"
id="toc-structured-data-gets-out-of-sync">4. Structured Data Gets Out of
Sync</a></li>
<li><a href="#form-validation-state-attributes-forgotten"
id="toc-form-validation-state-attributes-forgotten">5. Form Validation
State Attributes Forgotten</a></li>
<li><a href="#hidden-state-in-checkout-flow"
id="toc-hidden-state-in-checkout-flow">6. Hidden State in Checkout
Flow</a></li>
<li><a href="#error-messages-need-unique-ids"
id="toc-error-messages-need-unique-ids">7. Error Messages Need Unique
IDs</a></li>
<li><a href="#loading-states-without-expected-duration"
id="toc-loading-states-without-expected-duration">8. Loading States
Without Expected Duration</a></li>
<li><a href="#robots.txt-missing-sitemap-declaration"
id="toc-robots.txt-missing-sitemap-declaration">9. robots.txt Missing
Sitemap Declaration</a></li>
<li><a href="#schema.org-types-wrong-for-content"
id="toc-schema.org-types-wrong-for-content">10. Schema.org Types Wrong
for Content</a></li>
<li><a href="#testing-only-in-chrome"
id="toc-testing-only-in-chrome">11. Testing Only in Chrome</a></li>
<li><a href="#incomplete-pricing-disclosure-persisted"
id="toc-incomplete-pricing-disclosure-persisted">12. Incomplete Pricing
Disclosure Persisted</a></li>
<li><a href="#api-and-web-ui-out-of-sync"
id="toc-api-and-web-ui-out-of-sync">13. API and Web UI Out of
Sync</a></li>
<li><a href="#forgetting-mobile-viewport"
id="toc-forgetting-mobile-viewport">14. Forgetting Mobile
Viewport</a></li>
<li><a href="#authentication-required-for-public-data"
id="toc-authentication-required-for-public-data">15. Authentication
Required for Public Data</a></li>
<li><a href="#key-takeaways" id="toc-key-takeaways">Key
Takeaways</a></li>
</ul></li>
</ul>
</nav>
<h1 id="appendix-b-battle-tested-lessons">Appendix B: Battle-Tested
Lessons</h1>
<p>Real-world learnings from implementing AI agent compatibility
patterns in production. Mistakes to avoid and solutions that work.</p>
<h2 id="progressive-enhancement-requires-discipline">1. Progressive
Enhancement Requires Discipline</h2>
<p><strong>The Problem:</strong> Developers added JavaScript
enhancements that accidentally broke the served HTML baseline.</p>
<p><strong>What Happened:</strong></p>
<div class="sourceCode" id="cb1" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Server renders initial price</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div id<span class="op">=</span><span class="st">&quot;price&quot;</span><span class="op">&gt;</span>£149<span class="op">.</span><span class="dv">99</span><span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// JavaScript &quot;enhancement&quot; breaks it</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>script<span class="op">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;price&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;Loading...&#39;</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fetch</span>(<span class="st">&#39;/api/price&#39;</span>)<span class="op">.</span><span class="fu">then</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="fu">json</span>())<span class="op">.</span><span class="fu">then</span>(data <span class="kw">=&gt;</span> {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;price&#39;</span>)<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`£</span><span class="sc">${</span>data<span class="op">.</span><span class="at">price</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>script<span class="op">&gt;</span></span></code></pre></div>
<p>Agents saw “Loading…” because JavaScript replaced the server-rendered
content before fetching completed.</p>
<p><strong>Solution:</strong> Never replace server-rendered content -
only enhance it:</p>
<div class="sourceCode" id="cb2" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Server renders baseline</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>div id<span class="op">=</span><span class="st">&quot;price&quot;</span> data<span class="op">-</span><span class="kw">static</span><span class="op">=</span><span class="st">&quot;true&quot;</span><span class="op">&gt;</span>£149<span class="op">.</span><span class="dv">99</span><span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// JavaScript enhances without replacing</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>script<span class="op">&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> priceEl <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">&#39;price&#39;</span>)<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>priceEl<span class="op">.</span><span class="at">dataset</span><span class="op">.</span><span class="at">static</span>) <span class="cf">return</span><span class="op">;</span> <span class="co">// Safety check</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fetch</span>(<span class="st">&#39;/api/price&#39;</span>)<span class="op">.</span><span class="fu">then</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="fu">json</span>())<span class="op">.</span><span class="fu">then</span>(data <span class="kw">=&gt;</span> {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update only if price changed</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">price</span> <span class="op">!==</span> priceEl<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">[£,]</span><span class="ss">/g</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      priceEl<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`£</span><span class="sc">${</span>data<span class="op">.</span><span class="at">price</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      priceEl<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(<span class="st">&#39;price-updated&#39;</span>)<span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>script<span class="op">&gt;</span></span></code></pre></div>
<p><strong>Lesson:</strong> JavaScript should enhance, never replace. If
server HTML works, JavaScript must preserve that baseline.</p>
<h2 id="toast-notifications-are-hard-to-kill">2. Toast Notifications are
Hard to Kill</h2>
<p><strong>The Problem:</strong> Design team loved toast notifications.
Developers kept reintroducing them despite knowing they break
agents.</p>
<p><strong>What Happened:</strong> After removing toasts, a new feature
added them back:</p>
<div class="sourceCode" id="cb3" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Removed from form validation (good!)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// But reintroduced in shopping cart (bad!)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addToCart</span>(item)<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showToast</span>(<span class="st">&#39;Item added!&#39;</span>)<span class="op">;</span> <span class="co">// Breaks agents again</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Solution:</strong> Establish a component library policy:</p>
<div class="sourceCode" id="cb4" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// toast.js - Make breaking changes hard to reintroduce</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">showToast</span>(message) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="st">&#39;Toast notifications break AI agents. Use persistentAlert() instead.&#39;</span>)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Toast notifications disabled. Use persistentAlert().&#39;</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">function</span> <span class="fu">persistentAlert</span>(message<span class="op">,</span> containerId <span class="op">=</span> <span class="st">&#39;alerts&#39;</span>) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(containerId)<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> alert <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&#39;div&#39;</span>)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  alert<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">&#39;persistent-alert&#39;</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  alert<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;role&#39;</span><span class="op">,</span> <span class="st">&#39;status&#39;</span>)<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  alert<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> message<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">appendChild</span>(alert)<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> alert<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Lesson:</strong> Make anti-patterns hard to reintroduce.
Deprecate problematic functions and provide better alternatives.</p>
<h2 id="pagination-removal-needs-backend-changes">3. Pagination Removal
Needs Backend Changes</h2>
<p><strong>The Problem:</strong> Removed pagination from frontend, but
backend still limited results to 10 items per page.</p>
<p><strong>Frontend change:</strong></p>
<div class="sourceCode" id="cb5" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Removed pagination UI</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Added &quot;Show all&quot; button</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>button onclick<span class="op">=</span><span class="st">&quot;showAll()&quot;</span><span class="op">&gt;</span>Show all results<span class="op">&lt;/</span>button<span class="op">&gt;</span></span></code></pre></div>
<p><strong>Backend still had:</strong></p>
<div class="sourceCode" id="cb6" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/products&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> limit <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> <span class="co">// Hardcoded limit still here!</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="st">&#39;SELECT * FROM products LIMIT ?&#39;</span><span class="op">,</span> [limit])<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(products)<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Agents requesting <code>/products</code> still got only 10
results.</p>
<p><strong>Solution:</strong> Backend must support full retrieval:</p>
<div class="sourceCode" id="cb7" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/products&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Support both paginated and full retrieval</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> limit <span class="op">=</span> req<span class="op">.</span><span class="at">query</span><span class="op">.</span><span class="at">limit</span> <span class="op">?</span> <span class="pp">parseInt</span>(req<span class="op">.</span><span class="at">query</span><span class="op">.</span><span class="at">limit</span>) <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> offset <span class="op">=</span> req<span class="op">.</span><span class="at">query</span><span class="op">.</span><span class="at">offset</span> <span class="op">?</span> <span class="pp">parseInt</span>(req<span class="op">.</span><span class="at">query</span><span class="op">.</span><span class="at">offset</span>) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> query <span class="op">=</span> <span class="st">&#39;SELECT * FROM products&#39;</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> params <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (limit) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    query <span class="op">+=</span> <span class="st">&#39; LIMIT ? OFFSET ?&#39;</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [limit<span class="op">,</span> offset]<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> products <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(query<span class="op">,</span> params)<span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    products<span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">total</span><span class="op">:</span> db<span class="op">.</span><span class="fu">query</span>(<span class="st">&#39;SELECT COUNT(*) FROM products&#39;</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">count</span><span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">returned</span><span class="op">:</span> products<span class="op">.</span><span class="at">length</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Lesson:</strong> Frontend and backend changes must be
coordinated. Removing pagination UI doesn’t help if API still limits
results.</p>
<h2 id="structured-data-gets-out-of-sync">4. Structured Data Gets Out of
Sync</h2>
<p><strong>The Problem:</strong> HTML pricing and JSON-LD pricing showed
different values after a price update.</p>
<p><strong>What Happened:</strong></p>
<div class="sourceCode" id="cb8" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- HTML updated --&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">&quot;price&quot;</span><span class="dt">&gt;</span>£159.99<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- JSON-LD forgotten --&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">&quot;application/ld+json&quot;</span><span class="dt">&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;@type&quot;</span><span class="op">:</span> <span class="st">&quot;Offer&quot;</span><span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;price&quot;</span><span class="op">:</span> <span class="st">&quot;149.99&quot;</span>  <span class="op">&lt;!--</span> Old price<span class="op">!</span> <span class="op">--&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Agents reading JSON-LD got wrong price.</p>
<p><strong>Solution:</strong> Generate JSON-LD from the same data source
as HTML:</p>
<div class="sourceCode" id="cb9" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Server-side template</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">renderProduct</span>(product) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div class=&quot;price&quot;&gt;</span><span class="sc">${</span>product<span class="op">.</span><span class="at">formattedPrice</span><span class="sc">}</span><span class="vs">&lt;/div&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;script type=&quot;application/ld+json&quot;&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span><span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@context&quot;</span><span class="op">:</span> <span class="st">&quot;https://schema.org&quot;</span><span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;@type&quot;</span><span class="op">:</span> <span class="st">&quot;Offer&quot;</span><span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;price&quot;</span><span class="op">:</span> product<span class="op">.</span><span class="at">price</span><span class="op">,</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;priceCurrency&quot;</span><span class="op">:</span> product<span class="op">.</span><span class="at">currency</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    })<span class="sc">}</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/script&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Lesson:</strong> Structured data and HTML must share the same
data source. Don’t maintain prices in two places.</p>
<h2 id="form-validation-state-attributes-forgotten">5. Form Validation
State Attributes Forgotten</h2>
<p><strong>The Problem:</strong> Added
<code>data-validation-state</code> to some form fields but not others.
Inconsistent implementation confused both developers and agents.</p>
<p><strong>What Happened:</strong></p>
<div class="sourceCode" id="cb10" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="ot"> data-validation-state</span><span class="op">=</span><span class="st">&quot;valid&quot;</span><span class="dt">&gt;</span> <span class="co">&lt;!-- Has state --&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;phone&quot;</span><span class="dt">&gt;</span> <span class="co">&lt;!-- Missing state --&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;postcode&quot;</span><span class="ot"> data-validation-state</span><span class="op">=</span><span class="st">&quot;invalid&quot;</span><span class="dt">&gt;</span> <span class="co">&lt;!-- Has state --&gt;</span></span></code></pre></div>
<p>Agents couldn’t determine phone field status.</p>
<p><strong>Solution:</strong> Validation framework ensures consistent
state:</p>
<div class="sourceCode" id="cb11" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FormValidator {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(formId) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">form</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(formId)<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ensure ALL inputs have validation state</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">form</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">&#39;input, select, textarea&#39;</span>)<span class="op">.</span><span class="fu">forEach</span>(field <span class="kw">=&gt;</span> {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>field<span class="op">.</span><span class="fu">hasAttribute</span>(<span class="st">&#39;data-validation-state&#39;</span>)) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        field<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-validation-state&#39;</span><span class="op">,</span> <span class="st">&#39;empty&#39;</span>)<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateField</span>(field<span class="op">,</span> state) {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    field<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-validation-state&#39;</span><span class="op">,</span> state)<span class="op">;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    field<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;aria-invalid&#39;</span><span class="op">,</span> state <span class="op">===</span> <span class="st">&#39;invalid&#39;</span>)<span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Lesson:</strong> Establish patterns that ensure consistency.
If one field has state attributes, all fields should have them.</p>
<h2 id="hidden-state-in-checkout-flow">6. Hidden State in Checkout
Flow</h2>
<p><strong>The Problem:</strong> Checkout steps tracked in JavaScript,
not reflected in URL or DOM attributes.</p>
<p><strong>What Happened:</strong></p>
<div class="sourceCode" id="cb12" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Step tracked only in JavaScript</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> currentStep <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">nextStep</span>() {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  currentStep<span class="op">++;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateUI</span>()<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Agents couldn’t tell which checkout step they were on. Refreshing the
page lost progress.</p>
<p><strong>Solution:</strong> Explicit state in URL and DOM:</p>
<div class="sourceCode" id="cb13" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// URL reflects state</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">goToStep</span>(step) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="at">history</span><span class="op">.</span><span class="fu">pushState</span>({step}<span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="vs">`/checkout?step=</span><span class="sc">${</span>step<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">&#39;data-checkout-step&#39;</span><span class="op">,</span> step)<span class="op">;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateUI</span>(step)<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Restore state on page load</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;load&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> <span class="kw">new</span> <span class="fu">URLSearchParams</span>(<span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">search</span>)<span class="op">;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> step <span class="op">=</span> params<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;step&#39;</span>) <span class="op">||</span> <span class="st">&#39;1&#39;</span><span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">goToStep</span>(step)<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Lesson:</strong> State must be visible in URL and DOM. Hidden
JavaScript state breaks agents and hurts users (no bookmark, no
refresh).</p>
<h2 id="error-messages-need-unique-ids">7. Error Messages Need Unique
IDs</h2>
<p><strong>The Problem:</strong> Multiple validation errors all had
<code>id="error"</code>, breaking ARIA associations.</p>
<p><strong>What Happened:</strong></p>
<div class="sourceCode" id="cb14" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="ot"> aria-describedby</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="dt">&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="dt">&gt;</span>Invalid email<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;phone&quot;</span><span class="ot"> aria-describedby</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="dt">&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;error&quot;</span><span class="dt">&gt;</span>Invalid phone<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span> <span class="co">&lt;!-- Duplicate ID! --&gt;</span></span></code></pre></div>
<p>Screen readers and agents couldn’t associate errors with fields.</p>
<p><strong>Solution:</strong> Unique error IDs per field:</p>
<div class="sourceCode" id="cb15" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;email&quot;</span><span class="ot"> aria-describedby</span><span class="op">=</span><span class="st">&quot;email-error&quot;</span><span class="dt">&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;email-error&quot;</span><span class="dt">&gt;</span>Invalid email format<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;phone&quot;</span><span class="ot"> aria-describedby</span><span class="op">=</span><span class="st">&quot;phone-error&quot;</span><span class="dt">&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;phone-error&quot;</span><span class="dt">&gt;</span>Invalid phone format<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p><strong>Lesson:</strong> Every error message needs a unique ID. Use
pattern: <code>{fieldId}-error</code>.</p>
<h2 id="loading-states-without-expected-duration">8. Loading States
Without Expected Duration</h2>
<p><strong>The Problem:</strong> Added <code>data-state="loading"</code>
but agents still didn’t know how long to wait.</p>
<p><strong>First attempt:</strong></p>
<div class="sourceCode" id="cb16" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-state</span><span class="op">=</span><span class="st">&quot;loading&quot;</span><span class="dt">&gt;</span>Loading...<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Better, but agents timeout randomly - some after 5 seconds, some
after 30 seconds.</p>
<p><strong>Solution:</strong> Provide expected duration:</p>
<div class="sourceCode" id="cb17" data-role="code-container"><pre
class="sourceCode html"><code class="sourceCode html" data-role="code-content"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> data-state</span><span class="op">=</span><span class="st">&quot;loading&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ot">     data-load-started</span><span class="op">=</span><span class="st">&quot;2025-01-04T10:30:00Z&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ot">     data-expected-duration</span><span class="op">=</span><span class="st">&quot;2000&quot;</span><span class="dt">&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  Loading product information (estimated 2 seconds)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre></div>
<p>Agents can now make informed timeout decisions.</p>
<p><strong>Lesson:</strong> Loading states should indicate expected
duration. “Loading…” is insufficient - specify how long.</p>
<h2 id="robots.txt-missing-sitemap-declaration">9. robots.txt Missing
Sitemap Declaration</h2>
<p><strong>The Problem:</strong> Created robots.txt but forgot sitemap
declaration. Agents couldn’t discover content efficiently.</p>
<p><strong>First version:</strong></p>
<pre class="text" data-role="code-block" data-language="text"><code>User-agent: *
Disallow: /admin/</code></pre>
<p>Works, but agents have to crawl entire site to discover
structure.</p>
<p><strong>Better:</strong></p>
<pre class="text" data-role="code-block" data-language="text"><code>User-agent: *
Disallow: /admin/

Sitemap: https://example.com/sitemap.xml</code></pre>
<p>Agents now discover 10,000 pages instantly instead of crawling
slowly.</p>
<p><strong>Lesson:</strong> robots.txt should always declare sitemap.
Dramatically improves discoverability.</p>
<h2 id="schema.org-types-wrong-for-content">10. Schema.org Types Wrong
for Content</h2>
<p><strong>The Problem:</strong> Used <code>Article</code> type for
product pages. Agents expected article content, got confused by
pricing.</p>
<p><strong>Wrong:</strong></p>
<div class="sourceCode" id="cb20" data-role="code-container"><pre
class="sourceCode json"><code class="sourceCode json" data-role="code-content"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Article&quot;</span><span class="fu">,</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Wireless Headphones&quot;</span><span class="fu">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;149.99&quot;</span>  <span class="er">//</span> <span class="er">Articles</span> <span class="er">don&#39;t</span> <span class="er">have</span> <span class="er">prices!</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Right:</strong></p>
<div class="sourceCode" id="cb21" data-role="code-container"><pre
class="sourceCode json"><code class="sourceCode json" data-role="code-content"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Product&quot;</span><span class="fu">,</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;Wireless Headphones&quot;</span><span class="fu">,</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;offers&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;@type&quot;</span><span class="fu">:</span> <span class="st">&quot;Offer&quot;</span><span class="fu">,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;149.99&quot;</span><span class="fu">,</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;priceCurrency&quot;</span><span class="fu">:</span> <span class="st">&quot;GBP&quot;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Lesson:</strong> Use correct Schema.org types: Product for
products, Article for articles, LocalBusiness for businesses. Type
mismatch confuses agents.</p>
<h2 id="testing-only-in-chrome">11. Testing Only in Chrome</h2>
<p><strong>The Problem:</strong> Tested agent compatibility only in
Chrome DevTools with JavaScript disabled.</p>
<p><strong>What we missed:</strong> Server-rendered HTML had
Chrome-specific CSS that broke in other contexts:</p>
<div class="sourceCode" id="cb22" data-role="code-container"><pre
class="sourceCode css"><code class="sourceCode css" data-role="code-content"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.price</span> {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span><span class="ch">:</span> <span class="dv">-webkit-box</span><span class="op">;</span> <span class="co">/* Chrome-specific */</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Agents parsing without browser context saw broken layout
references.</p>
<p><strong>Solution:</strong> Test with actual curl/wget:</p>
<div class="sourceCode" id="cb23" data-role="code-container"><pre
class="sourceCode bash"><code class="sourceCode bash" data-role="code-content"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test served HTML as agents see it</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> https://example.com/product/123 <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> <span class="st">&quot;price&quot;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify structured data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-s</span> https://example.com/product/123 <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grep</span> <span class="at">-o</span> <span class="st">&#39;&lt;script type=&quot;application/ld+json&quot;&gt;.*&lt;/script&gt;&#39;</span> <span class="kw">|</span> <span class="dt">\</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">jq</span> .</span></code></pre></div>
<p><strong>Lesson:</strong> Test served HTML with actual HTTP clients
(curl/wget), not just browser DevTools.</p>
<h2 id="incomplete-pricing-disclosure-persisted">12. Incomplete Pricing
Disclosure Persisted</h2>
<p><strong>The Problem:</strong> Changed “From £99” to “£149.99” on
product pages, but forgot checkout summary, confirmation emails, and API
responses.</p>
<p><strong>Inconsistency:</strong></p>
<ul>
<li>Product page: “£149.99” (fixed)</li>
<li>Cart: “From £99” (not fixed)</li>
<li>Email: “Starting at £99” (not fixed)</li>
<li>API: <code>{"base_price": 99}</code> (not fixed)</li>
</ul>
<p><strong>Solution:</strong> Search entire codebase for pricing
patterns:</p>
<div class="sourceCode" id="cb24" data-role="code-container"><pre
class="sourceCode bash"><code class="sourceCode bash" data-role="code-content"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all price references</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;From £&quot;</span> .</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;Starting at&quot;</span> .</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> <span class="at">-r</span> <span class="st">&quot;base_price&quot;</span> .</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Update systematically</span></span></code></pre></div>
<p><strong>Lesson:</strong> Pattern changes must be applied everywhere.
Use grep to find all instances, update systematically.</p>
<h2 id="api-and-web-ui-out-of-sync">13. API and Web UI Out of Sync</h2>
<p><strong>The Problem:</strong> Fixed web UI for agents, but API still
returned paginated results and incomplete data.</p>
<p><strong>Web UI:</strong></p>
<ul>
<li>Shows all products on one page [YES]</li>
<li>Complete pricing visible [YES]</li>
<li>Structured data present [YES]</li>
</ul>
<p><strong>API:</strong></p>
<ul>
<li>Returns 10 products per page [NO]</li>
<li>Missing tax in price response [NO]</li>
<li>No structured format [NO]</li>
</ul>
<p>Agents using API got inferior experience to agents scraping web
UI.</p>
<p><strong>Solution:</strong> API should be first-class interface:</p>
<div class="sourceCode" id="cb25" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/products&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">products</span><span class="op">:</span> db<span class="op">.</span><span class="fu">getAllProducts</span>()<span class="op">.</span><span class="fu">map</span>(p <span class="kw">=&gt;</span> ({</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">id</span><span class="op">:</span> p<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">name</span><span class="op">:</span> p<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">amount</span><span class="op">:</span> p<span class="op">.</span><span class="at">price</span><span class="op">,</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">currency</span><span class="op">:</span> <span class="st">&#39;GBP&#39;</span><span class="op">,</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">includes_vat</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">formatted</span><span class="op">:</span> <span class="vs">`£</span><span class="sc">${</span>p<span class="op">.</span><span class="at">price</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">availability</span><span class="op">:</span> {</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">in_stock</span><span class="op">:</span> p<span class="op">.</span><span class="at">stock</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quantity</span><span class="op">:</span> p<span class="op">.</span><span class="at">stock</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">meta</span><span class="op">:</span> {</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">total</span><span class="op">:</span> db<span class="op">.</span><span class="fu">countProducts</span>()<span class="op">,</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">schema</span><span class="op">:</span> <span class="st">&#39;https://schema.org/Product&#39;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Lesson:</strong> API must match or exceed web UI quality.
Don’t fix UI and leave API broken.</p>
<h2 id="forgetting-mobile-viewport">14. Forgetting Mobile Viewport</h2>
<p><strong>The Problem:</strong> Fixed desktop patterns but mobile site
still paginated, hid content, showed incomplete prices.</p>
<p><strong>Root cause:</strong> Separate mobile codebase or responsive
breakpoints that reverted to problematic patterns.</p>
<p><strong>Solution:</strong> Test agent patterns at mobile
breakpoints:</p>
<div class="sourceCode" id="cb26" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Test with mobile viewport</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { test } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;@playwright/test&#39;</span>)<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">&#39;mobile pricing complete&#39;</span><span class="op">,</span> <span class="kw">async</span> ({ page }) <span class="kw">=&gt;</span> {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> page<span class="op">.</span><span class="fu">setViewportSize</span>({ <span class="dt">width</span><span class="op">:</span> <span class="dv">375</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">667</span> })<span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> page<span class="op">.</span><span class="fu">goto</span>(<span class="st">&#39;/product/123&#39;</span>)<span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> price <span class="op">=</span> <span class="cf">await</span> page<span class="op">.</span><span class="fu">textContent</span>(<span class="st">&#39;.price&#39;</span>)<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(price)<span class="op">.</span><span class="fu">toContain</span>(<span class="st">&#39;£149.99&#39;</span>)<span class="op">;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(price)<span class="op">.</span><span class="at">not</span><span class="op">.</span><span class="fu">toContain</span>(<span class="st">&#39;From&#39;</span>)<span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Lesson:</strong> Agent-friendly patterns must work on mobile
too. Test all breakpoints.</p>
<h2 id="authentication-required-for-public-data">15. Authentication
Required for Public Data</h2>
<p><strong>The Problem:</strong> Added authentication to API endpoints,
breaking agent access to public product data.</p>
<p><strong>Before (working):</strong></p>
<div class="sourceCode" id="cb27" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/products/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(<span class="fu">getProduct</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>))<span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>After (broke agents):</strong></p>
<div class="sourceCode" id="cb28" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/products/:id&#39;</span><span class="op">,</span> requireAuth<span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(<span class="fu">getProduct</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>))<span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>Public product data now requires authentication. Agents can’t browse
products.</p>
<p><strong>Solution:</strong> Separate public and private data:</p>
<div class="sourceCode" id="cb29" data-role="code-container"><pre
class="sourceCode javascript"><code class="sourceCode javascript" data-role="code-content"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Public product data - no auth required</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/public/products/:id&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>(<span class="fu">getProduct</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>))<span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Private customer-specific data - auth required</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/customer/products/:id&#39;</span><span class="op">,</span> requireAuth<span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="fu">getProduct</span>(req<span class="op">.</span><span class="at">params</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> customerData <span class="op">=</span> <span class="fu">getCustomerProductData</span>(req<span class="op">.</span><span class="at">user</span><span class="op">.</span><span class="at">id</span><span class="op">,</span> product<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">json</span>({ <span class="op">...</span>product<span class="op">,</span> customerData })<span class="op">;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p><strong>Lesson:</strong> Public data should remain public. Don’t add
authentication to publicly-browsable content.</p>
<h2 id="key-takeaways">Key Takeaways</h2>
<ol type="1">
<li><strong>Progressive enhancement requires discipline:</strong>
JavaScript must enhance, never replace server-rendered content</li>
<li><strong>Consistency is critical:</strong> If one field has state
attributes, all fields must have them</li>
<li><strong>Frontend and backend must align:</strong> Removing
pagination UI doesn’t help if API limits results</li>
<li><strong>Structured data must stay in sync:</strong> Generate JSON-LD
from same source as HTML</li>
<li><strong>State must be visible:</strong> Hidden JavaScript state
breaks agents and users</li>
<li><strong>Test comprehensively:</strong> Test served HTML with
curl/wget, not just browser DevTools</li>
<li><strong>Pattern changes are global:</strong> Use grep to find all
instances, update systematically</li>
<li><strong>API must be first-class:</strong> Don’t fix UI and leave API
broken</li>
<li><strong>Mobile matters:</strong> Agent patterns must work at all
breakpoints</li>
<li><strong>Public data stays public:</strong> Don’t add authentication
to browsable content</li>
</ol>
<hr>
<nav class="appendix-navigation" role="navigation" aria-label="Appendix Navigation">
    <p><a href="appendix-index.html">← Back to Appendices Index</a></p>
    <p>Quick navigation:
        <a href="appendix-a.html">A</a> |
        <a href="appendix-b.html">B</a> |
        <a href="appendix-c.html">C</a> |
        <a href="appendix-d.html">D</a> |
        <a href="appendix-e.html">E</a> |
        <a href="appendix-f.html">F</a> |
        <a href="appendix-g.html">G</a> |
        <a href="appendix-h.html">H</a> |
        <a href="appendix-i.html">I</a> |
        <a href="appendix-j.html">J</a> |
        <a href="appendix-k.html">K</a> |
        <a href="appendix-l.html">L</a>
    </p>
</nav>

  <!-- Floating home button (top-left) -->
  <a href="index.html" class="floating-home-button" aria-label="Back to Home">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
      <path d="M8 0L0 8h3v8h10V8h3L8 0zm0 2.5L13.5 8H11v6H5V8H2.5L8 2.5z"/>
    </svg>
    Home
  </a>
  <!-- Floating back to top button (bottom-left) -->
  <a href="#" class="floating-top-button" aria-label="Back to Top" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
      <path d="M8 3.5l-5.5 5.5L4 10.5l3-3v8.5h2V7.5l3 3L13.5 9z"/>
    </svg>
    Top
  </a>

  <script>
    // Add copy buttons to all code blocks
    document.addEventListener('DOMContentLoaded', function() {
      // Find both wrapped code blocks (div.sourceCode) and standalone pre blocks
      const wrappedBlocks = document.querySelectorAll('div.sourceCode');
      const standaloneBlocks = document.querySelectorAll('pre[data-role="code-block"]:not(.sourceCode)');

      // Process wrapped code blocks (HTML, JavaScript, etc.)
      wrappedBlocks.forEach(function(block) {
        addCopyButton(block, function(block) {
          const codeElement = block.querySelector('code');
          let text = '';
          const spans = codeElement.querySelectorAll('span[id^="cb"]');
          spans.forEach(function(span) {
            const nodes = Array.from(span.childNodes);
            nodes.forEach(function(node) {
              if (node.nodeType === Node.TEXT_NODE) {
                text += node.textContent;
              } else if (node.nodeName !== 'A') {
                text += node.textContent;
              }
            });
          });
          return text;
        });
      });

      // Process standalone pre blocks (text, robots.txt, etc.)
      standaloneBlocks.forEach(function(block) {
        addCopyButton(block, function(block) {
          const codeElement = block.querySelector('code');
          return codeElement ? codeElement.textContent : block.textContent;
        });
      });

      // Helper function to add copy button to any block
      function addCopyButton(block, extractTextFn) {
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.setAttribute('aria-label', 'Copy code to clipboard');

        button.addEventListener('click', function() {
          const text = extractTextFn(block);

          navigator.clipboard.writeText(text).then(function() {
            button.textContent = 'Copied';
            button.classList.add('copied');
            setTimeout(function() {
              button.textContent = 'Copy';
              button.classList.remove('copied');
            }, 2000);
          }).catch(function(err) {
            console.error('Failed to copy:', err);
            button.textContent = 'Failed';
            setTimeout(function() {
              button.textContent = 'Copy';
            }, 2000);
          });
        });

        block.insertBefore(button, block.firstChild);
      }
    });
  </script>
</body>
</html>
