# View MyBlog Block

## Overview

The View MyBlog block dynamically fetches and displays blog content from a JSON data source, reproducing the layout and functionality of `my-blog.html` as an EDS block.

## Features

- **Dynamic Content Loading**: Fetches blog data from `/my-blog.json`
- **Configurable Data Source**: Optional parameter to specify custom JSON file path
- **Auto-Generated Latest Posts**: Automatically generates "Latest Posts" section from the 3 most recent non-index posts (hidden in single category mode)
- **Manually Curated Most Visited**: Optional "Most Visited" section for highlighting popular content
- **Index Page Filtering**: Automatically filters out index pages (URLs ending with `/`, `/index`, `/index.html`, `/index.htm`)
- **Smart Category Management**: Empty categories are automatically hidden after filtering
- **Single Category Mode**: Automatically simplifies layout when only one category exists (hides Latest Posts and Category Map)
- **Responsive Design**: Mobile-first responsive layout
- **Smart Category Navigation**: Category map automatically hidden when only one category exists
- **Full Blog Archives**: Renders all blog posts organized by category
- **Flexible Sorting**: Categories can specify sort order (oldest-first for tutorials)
- **Error Handling**: Graceful error handling with user-friendly messages

## Usage

### In Google Docs

**Default (uses `/my-blog.json`):**
```
| view-myblog |
|-------------|
```

**With custom JSON file:**
```
| view-myblog |
|-------------|
| /path/to/custom-blog.json |
```

### In HTML

**Default:**
```html
<div class="view-myblog">
  <!-- Content will be loaded here -->
</div>
```

**With custom JSON:**
```html
<div class="view-myblog">
  /path/to/custom-blog.json
</div>
```

## Configuration

### JSON Data Source

By default, the block loads data from `/my-blog.json`. You can specify a custom JSON file path by adding it as the block content. If no path is specified, the block defaults to `/my-blog.json`.

### Auto-Generated Latest Posts (Recommended)

**BEST PRACTICE**: Do not include a `latestPosts` array in your JSON file. Let the block auto-generate it.

When `latestPosts` is omitted (or empty), the block automatically generates it by:
1. Collecting all posts from all categories
2. Filtering out index pages
3. Sorting by `lastModified` date (newest first)
4. Taking the top 3 most recent posts

**Benefits of auto-generation:**
- Always up-to-date without manual maintenance
- Automatically reflects newest content
- Simpler JSON structure
- Eliminates manual curation overhead

**Example - Minimal JSON structure:**
```json
{
  "categories": [
    {
      "id": "blog",
      "name": "Blog Posts",
      "posts": [
        {
          "title": "My Latest Post",
          "url": "/blog/my-latest-post",
          "description": "Description here",
          "lastModified": "2025-01-20"
        }
      ]
    }
  ]
}
```

The block will automatically create a "Latest Posts" section from the 3 most recent posts across all categories.

### Index Page Filtering

The block automatically filters out index pages from all sections (Latest Posts, Most Visited, and category sections). Index pages are identified by URLs that end with:
- `/` (e.g., `/blogs/ddt/ai/`)
- `/index` (e.g., `/blogs/ddt/index`)
- `/index.html` or `/index.htm`

This ensures that only actual blog post pages are displayed, not category or section landing pages.

### Content Structure

The JSON file should have the following structure:

```json
{
  "metadata": {
    "last-updated": "2025-11-25"
  },
  "mostVisited": [
    {
      "title": "Popular Post",
      "url": "/path/to/post",
      "description": "Post description"
    }
  ],
  "categoryMap": [
    {
      "id": "category-id",
      "name": "Category Name",
      "count": 10,
      "description": "Category description"
    }
  ],
  "categories": [
    {
      "id": "category-id",
      "name": "Category Name",
      "sortOrder": "oldest-first",
      "posts": [
        {
          "title": "Post Title",
          "url": "/path/to/post",
          "description": "Post description",
          "lastModified": "2025-01-15"
        }
      ]
    }
  ]
}
```

#### Optional Fields

Several fields in the JSON structure are optional:

- **`metadata`** - Contains information about the data file itself (e.g., `last-updated`)
- **`latestPosts`** - **DO NOT INCLUDE** - Auto-generated by the block from the 3 most recent posts. Including it manually requires maintenance and defeats the purpose of auto-generation.
- **`mostVisited`** - **MANUALLY CURATED** - Optional array of popular posts. If missing, the "Most Visited" section will not be displayed. Unlike `latestPosts`, this should be manually maintained to highlight your most important content.

#### Sort Order

Categories can optionally specify a `sortOrder` field:
- `"oldest-first"` - Sorts posts by date ascending (oldest to newest). Perfect for tutorial series like "Part 0, Part 1, Part 2..."
- Default (no sortOrder specified) - Posts display in the order they appear in JSON (typically newest first)

## Behavior

### Single Category Mode

When only one active category exists (after filtering index pages and empty categories):
- **Latest Posts section**: Hidden (not displayed)
- **Category Map**: Hidden (not displayed)
- **Most Visited section**: Still displayed if available
- **Category section**: Displayed directly without navigation overhead

This creates a cleaner, simpler layout when all posts belong to a single category.

### Link Handling

- **Blog Post Links**: All blog post links open in new tabs (`target="_blank"`)
  - Includes security attributes (`rel="noopener noreferrer"`)
  - Applies to Latest Posts, Most Visited, and all category posts
- **Category Map Links**: Hash anchor links stay on same page (internal navigation)
- **Link Styling**:
  - Default: Blue color (`#667eea`) - clearly visible as links
  - Hover: Purple color (`#764ba2`) with underline

### Category Map Display

- **Multiple Categories**: Category map table displayed with navigation
- **Single Category**: Category map automatically hidden
- **Empty Categories**: Categories with 0 posts after filtering are not displayed
- **Dynamic Counts**: Category counts are recalculated after index page filtering

## Styling

The block includes comprehensive CSS that matches the original `my-blog.html` design:

- **Latest Posts**: Blue gradient section
- **Most Visited**: Orange gradient section
- **Category Map**: Clean table with hover effects (hidden when only one category)
- **Blog Entries**: Compact card layout with minimal white space
- **Links**: Blue links with purple hover state and underline
- **Responsive**: Optimized for mobile, tablet, and desktop

## Customization

### Styling

Modify `view-myblog.css` to customize:

- Colors (gradients, text, borders)
- Spacing (padding, margins)
- Typography (font sizes, weights)
- Responsive breakpoints

## Development

### Local Testing

1. Start the development server:
   ```bash
   npm run debug
   ```

2. Open the test file:
   ```
   http://localhost:3000/blocks/view-myblog/test.html
   ```

### Browser Testing

Test in multiple browsers:
- Chrome/Edge (Chromium)
- Firefox
- Safari

## Accessibility

- Semantic HTML elements (`<nav>`, `<article>`, `<section>`)
- ARIA labels for navigation
- Keyboard accessible links and buttons
- Proper heading hierarchy (h2 for sections, h3 for entries)
- Color contrast meets WCAG AA standards

## Performance

- Async data loading
- Minimal DOM manipulation
- Efficient CSS with no external dependencies
- Lazy loading ready (can be enhanced with Intersection Observer)

## Browser Support

- Modern browsers (Chrome, Firefox, Safari, Edge)
- ES6+ JavaScript
- CSS Grid and Flexbox
- Fetch API

## Related Files

- **JavaScript**: `view-myblog.js` - Block decoration logic
- **CSS**: `view-myblog.css` - Block styles
- **Data**: `/my-blog.json` - Blog content data
- **Test**: `test.html` - Local development test file

## Notes

- The block fetches data from `/my-blog.json` at runtime
- All blog content is defined in the JSON file
- Category links use hash anchors (e.g., `#eds-integrations`)
- Error handling displays user-friendly messages
- Index pages are automatically filtered from all sections
- Empty categories are automatically hidden

## Maintenance

To update blog content:
1. Edit `/my-blog.json` with new posts or categories
2. Content updates automatically without code changes
3. No need to rebuild or redeploy the block code
4. Index pages in the JSON will be automatically filtered out
