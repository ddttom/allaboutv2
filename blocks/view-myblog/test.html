<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View MyBlog Block - Test Suite</title>

    <!-- EDS Core Styles -->
    <link rel="stylesheet" href="/styles/styles.css">

    <style>
        /* EDS pattern - ensure body appears */
        body.appear {
            display: block;
        }

        /* Test page specific styles */
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .test-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
        }

        .test-header p {
            margin: 0.25rem 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .test-controls {
            background: #f5f5f5;
            padding: 1rem 1.5rem;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .test-controls label {
            font-weight: 600;
            color: #333;
        }

        .test-controls select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .test-controls select:hover {
            border-color: #667eea;
        }

        #status {
            margin-left: auto;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        #status.loading {
            background: #fff3cd;
            color: #856404;
        }

        #status.success {
            background: #d4edda;
            color: #155724;
        }

        #status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .test-info {
            background: #e3f2fd;
            padding: 1rem 1.5rem;
            border-left: 4px solid #2196f3;
            margin: 1.5rem;
            border-radius: 4px;
        }

        .test-info h3 {
            margin: 0 0 0.5rem 0;
            color: #1976d2;
            font-size: 1.1rem;
        }

        .test-info ul {
            margin: 0.5rem 0 0 1.5rem;
            padding: 0;
        }

        .test-info li {
            margin: 0.25rem 0;
            color: #555;
            font-size: 0.9rem;
        }

        .test-info code {
            background: white;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.85rem;
            color: #d63384;
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 0;
        }

        .test-scenario {
            background: #fff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 0 1.5rem 1.5rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .test-scenario h2 {
            margin: 0 0 1rem 0;
            color: #667eea;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .test-scenario-description {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            border-left: 3px solid #667eea;
        }

        .test-scenario-description p {
            margin: 0.5rem 0;
            color: #555;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .test-header h1 {
                font-size: 1.5rem;
            }

            .test-controls {
                flex-direction: column;
                align-items: stretch;
            }

            #status {
                margin-left: 0;
            }

            main {
                padding: 1rem 0;
            }

            .test-scenario {
                margin: 0 0.75rem 1rem 0.75rem;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>View MyBlog Block - Test Suite</h1>
        <p><strong>Block:</strong> view-myblog</p>
        <p><strong>Purpose:</strong> Dynamic blog content display with auto-generated latest posts and intelligent filtering</p>
    </div>

    <div class="test-controls">
        <label for="test-select">Test Scenario:</label>
        <select id="test-select">
            <option value="default">Full Data Test (Default)</option>
            <option value="single-category">Single Category Mode</option>
            <option value="no-latest">Without Latest Posts</option>
            <option value="no-visited">Without Most Visited</option>
            <option value="error">Error Handling Test</option>
        </select>
        <span id="status" class="loading">Loading...</span>
    </div>

    <div class="test-info">
        <h3>Current Test Scenario</h3>
        <p id="scenario-description">Select a test scenario to begin.</p>
        <ul id="scenario-details"></ul>
    </div>

    <main>
        <div class="test-scenario">
            <h2>Test Output</h2>
            <div class="test-scenario-description">
                <p><strong>Instructions:</strong> The block will render below. Check that all features display correctly.</p>
            </div>

            <!--
                EDS Block Structure:
                In production, this comes from Google Docs markdown:

                | View MyBlog |
                |-------------|
            -->
            <div>
                <div class="view-myblog"></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { loadBlock, decorateBlock } from '/scripts/aem.js';

        // Test scenario descriptions
        const scenarios = {
            default: {
                description: 'Tests full feature set with multiple categories, latest posts, most visited, and category map.',
                details: [
                    'Multiple active categories',
                    'Auto-generated Latest Posts (top 3)',
                    'Most Visited section',
                    'Category Map navigation',
                    'Index page filtering',
                    'Responsive layout'
                ],
                dataUrl: '/my-blog.json'
            },
            'single-category': {
                description: 'Tests single category mode where Latest Posts and Category Map are automatically hidden.',
                details: [
                    'Only one active category',
                    'Latest Posts hidden',
                    'Category Map hidden',
                    'Most Visited still shown',
                    'Simplified layout'
                ],
                dataUrl: '/my-blog.json' // Would filter to single category in real test
            },
            'no-latest': {
                description: 'Tests display without Latest Posts section.',
                details: [
                    'Most Visited section present',
                    'Category Map present',
                    'All category sections',
                    'No Latest Posts section'
                ],
                dataUrl: '/my-blog.json'
            },
            'no-visited': {
                description: 'Tests display without Most Visited section.',
                details: [
                    'Latest Posts section present',
                    'Category Map present',
                    'All category sections',
                    'No Most Visited section'
                ],
                dataUrl: '/my-blog.json'
            },
            error: {
                description: 'Tests error handling with invalid data URL.',
                details: [
                    'Fetch failure simulation',
                    'User-friendly error message',
                    'No console errors breaking page',
                    'Graceful degradation'
                ],
                dataUrl: '/nonexistent-blog.json'
            }
        };

        // Update status function
        function updateStatus(message, type = 'loading') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = type;
        }

        // Update scenario info
        function updateScenarioInfo(scenarioKey) {
            const scenario = scenarios[scenarioKey];
            const descEl = document.getElementById('scenario-description');
            const detailsEl = document.getElementById('scenario-details');

            descEl.textContent = scenario.description;
            detailsEl.innerHTML = scenario.details
                .map(detail => `<li>${detail}</li>`)
                .join('');
        }

        // Initialize the block
        async function initBlock(scenarioKey) {
            try {
                updateStatus('Initializing...', 'loading');

                // Add body.appear class (required by EDS)
                document.body.classList.add('appear');

                // Get the block element
                const block = document.querySelector('.view-myblog');
                if (!block) {
                    throw new Error('Block element not found');
                }

                // Clear any previous content
                block.innerHTML = '';

                // Set data URL based on scenario
                const scenario = scenarios[scenarioKey];
                if (scenario.dataUrl !== '/my-blog.json') {
                    block.textContent = scenario.dataUrl;
                }

                updateStatus('Decorating block...', 'loading');

                // EDS pattern: decorateBlock adds .block class and wraps content
                decorateBlock(block);

                updateStatus('Loading block content...', 'loading');

                // Load the block (fetches JS/CSS and runs decorate function)
                await loadBlock(block);

                updateStatus('Block loaded successfully!', 'success');

                // Log success for debugging
                // eslint-disable-next-line no-console
                console.log('View MyBlog block loaded successfully');
                // eslint-disable-next-line no-console
                console.log('Scenario:', scenarioKey);
                // eslint-disable-next-line no-console
                console.log('Block element:', block);

            } catch (error) {
                // eslint-disable-next-line no-console
                console.error('Failed to load block:', error);
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }

        // Handle scenario selection
        const testSelect = document.getElementById('test-select');
        testSelect.addEventListener('change', (e) => {
            const scenario = e.target.value;
            updateScenarioInfo(scenario);
            initBlock(scenario);
        });

        // Initialize with default scenario
        updateScenarioInfo('default');
        initBlock('default');
    </script>
</body>
</html>
