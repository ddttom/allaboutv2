<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test MD Link Conversion</title>
</head>
<body>
  <h1>Test MD Link Conversion Logic</h1>

  <h2>Test 1: With repo URL</h2>
  <div id="test1"></div>

  <h2>Test 2: Without repo URL (null)</h2>
  <div id="test2"></div>

  <h2>Test 3: Absolute URLs (should not convert)</h2>
  <div id="test3"></div>

  <script type="module">
    // Import the parseMarkdown function from ipynb-viewer
    // For testing purposes, we'll replicate the link conversion logic
    function testLinkConversion(markdown, repoUrl) {
      let html = markdown;

      // Links - convert .md files to repo URLs if repo is available
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (match, text, url) => {
        // Check if it's a .md file and we have a repo URL
        if (repoUrl && url.endsWith('.md') && !url.startsWith('http://') && !url.startsWith('https://')) {
          // Remove leading ./ or / from the path
          const cleanPath = url.replace(/^\.?\//, '');
          // Build full repo URL (assuming GitHub blob/main pattern)
          const fullUrl = `${repoUrl}/blob/main/${cleanPath}`;
          return `<a href="${fullUrl}" target="_blank" rel="noopener noreferrer">${text}</a>`;
        }
        return `<a href="${url}">${text}</a>`;
      });

      return html;
    }

    // Test 1: With repo URL
    const markdown1 = '[Guide](docs/guide.md)';
    const repoUrl = 'https://github.com/ddttom/allaboutV2';
    const result1 = testLinkConversion(markdown1, repoUrl);
    document.getElementById('test1').innerHTML = `
      <p><strong>Input:</strong> ${markdown1}</p>
      <p><strong>Repo:</strong> ${repoUrl}</p>
      <p><strong>Output:</strong> ${result1}</p>
      <p><strong>Expected:</strong> &lt;a href="https://github.com/ddttom/allaboutV2/blob/main/docs/guide.md" target="_blank" rel="noopener noreferrer"&gt;Guide&lt;/a&gt;</p>
      <p><strong>Status:</strong> ${result1.includes('github.com') && result1.includes('target="_blank"') ? '✅ PASS' : '❌ FAIL'}</p>
    `;

    // Test 2: Without repo URL
    const markdown2 = '[Guide](docs/guide.md)';
    const result2 = testLinkConversion(markdown2, null);
    document.getElementById('test2').innerHTML = `
      <p><strong>Input:</strong> ${markdown2}</p>
      <p><strong>Repo:</strong> null</p>
      <p><strong>Output:</strong> ${result2}</p>
      <p><strong>Expected:</strong> &lt;a href="docs/guide.md"&gt;Guide&lt;/a&gt;</p>
      <p><strong>Status:</strong> ${result2 === '<a href="docs/guide.md">Guide</a>' ? '✅ PASS' : '❌ FAIL'}</p>
    `;

    // Test 3: Absolute URLs (should not convert)
    const markdown3 = '[External](https://other.com/file.md)';
    const result3 = testLinkConversion(markdown3, repoUrl);
    document.getElementById('test3').innerHTML = `
      <p><strong>Input:</strong> ${markdown3}</p>
      <p><strong>Repo:</strong> ${repoUrl}</p>
      <p><strong>Output:</strong> ${result3}</p>
      <p><strong>Expected:</strong> &lt;a href="https://other.com/file.md"&gt;External&lt;/a&gt;</p>
      <p><strong>Status:</strong> ${result3 === '<a href="https://other.com/file.md">External</a>' ? '✅ PASS' : '❌ FAIL'}</p>
    `;

    console.log('Test 1 (with repo):', result1);
    console.log('Test 2 (without repo):', result2);
    console.log('Test 3 (absolute URL):', result3);
  </script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
      line-height: 1.6;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 3px solid #3498db;
      padding-bottom: 0.5rem;
    }
    h2 {
      color: #34495e;
      margin-top: 2rem;
      padding: 0.5rem;
      background: #ecf0f1;
      border-left: 4px solid #3498db;
    }
    #test1, #test2, #test3 {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #dee2e6;
      margin: 1rem 0;
    }
    p {
      margin: 0.5rem 0;
    }
    strong {
      color: #2980b9;
    }
  </style>
</body>
</html>
